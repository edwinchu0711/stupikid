<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase 影片資料庫</title>
  <style>
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }
      
      body {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          min-height: 100vh;
          padding: 20px;
      }
      
      .container {
          max-width: 800px;
          margin: 0 auto;
          background: white;
          border-radius: 15px;
          box-shadow: 0 10px 30px rgba(0,0,0,0.2);
          overflow: hidden;
      }
      
      .header {
          background: linear-gradient(45deg, #FF6B35, #F7931E);
          color: white;
          padding: 30px;
          text-align: center;
      }
      
      .header h1 {
          font-size: 2.5em;
          margin-bottom: 10px;
      }
      
      .content {
          padding: 30px;
      }
      
      .section {
          margin-bottom: 40px;
          padding: 20px;
          background: #f8f9fa;
          border-radius: 10px;
          border-left: 4px solid #FF6B35;
      }
      
      .section h2 {
          color: #24292e;
          margin-bottom: 20px;
          font-size: 1.5em;
      }
      
      .form-group {
          margin-bottom: 20px;
      }
      
      .form-group label {
          display: block;
          margin-bottom: 8px;
          font-weight: 600;
          color: #24292e;
      }
      
      .form-group input,
      .form-group textarea {
          width: 100%;
          padding: 12px 15px;
          border: 2px solid #e1e4e8;
          border-radius: 8px;
          font-size: 16px;
          transition: all 0.3s ease;
      }
      
      .form-group input:focus,
      .form-group textarea:focus {
          outline: none;
          border-color: #FF6B35;
          box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
      }
      
      .tags-input {
          display: flex;
          flex-wrap: wrap;
          gap: 8px;
          padding: 10px;
          border: 2px solid #e1e4e8;
          border-radius: 8px;
          min-height: 50px;
          cursor: text;
      }
      
      .tags-input:focus-within {
          border-color: #FF6B35;
          box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
      }
      
      .tag {
          background: linear-gradient(45deg, #FF6B35, #F7931E);
          color: white;
          padding: 5px 12px;
          border-radius: 20px;
          font-size: 14px;
          display: flex;
          align-items: center;
          gap: 5px;
      }
      
      .tag-remove {
          background: rgba(255,255,255,0.3);
          border: none;
          color: white;
          border-radius: 50%;
          width: 18px;
          height: 18px;
          cursor: pointer;
          font-size: 12px;
          display: flex;
          align-items: center;
          justify-content: center;
      }
      
      .tag-input {
          border: none;
          outline: none;
          flex: 1;
          min-width: 120px;
          padding: 8px;
          font-size: 16px;
      }
      
      .btn {
          padding: 12px 25px;
          border: none;
          border-radius: 8px;
          font-size: 16px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s ease;
          margin-right: 10px;
          margin-bottom: 10px;
      }
      
      .btn-primary {
          background: linear-gradient(45deg, #FF6B35, #F7931E);
          color: white;
      }
      
      .btn-primary:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 20px rgba(255, 107, 53, 0.3);
      }
      
      .btn-secondary {
          background: linear-gradient(45deg, #6c757d, #5a6268);
          color: white;
      }
      
      .btn-secondary:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 20px rgba(108, 117, 125, 0.3);
      }
      
      .btn-danger {
          background: linear-gradient(45deg, #dc3545, #c82333);
          color: white;
      }
      
      .btn-danger:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 20px rgba(220, 53, 69, 0.3);
      }
      
      .video-list {
          display: grid;
          gap: 20px;
      }
      
      .video-item {
          background: white;
          border: 1px solid #e1e4e8;
          border-radius: 10px;
          padding: 20px;
          box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      }
      
      .video-title {
          font-size: 1.3em;
          font-weight: 600;
          color: #24292e;
          margin-bottom: 10px;
      }
      
      .video-id {
          font-size: 0.9em;
          color: #586069;
          margin-bottom: 10px;
      }
      
      .video-src {
          font-size: 0.9em;
          color: #0366d6;
          margin-bottom: 15px;
          word-break: break-all;
      }
      
      .video-tags {
          display: flex;
          flex-wrap: wrap;
          gap: 5px;
          margin-bottom: 15px;
      }
      
      .video-tag {
          background: #f1f8ff;
          color: #0366d6;
          padding: 3px 8px;
          border-radius: 12px;
          font-size: 12px;
          border: 1px solid #c8e1ff;
      }
      
      .alert {
          padding: 15px 20px;
          margin: 20px 0;
          border-radius: 8px;
          font-weight: 500;
      }
      
      .alert.success {
          background: #d4edda;
          color: #155724;
          border: 1px solid #c3e6cb;
      }
      
      .alert.error {
          background: #f8d7da;
          color: #721c24;
          border: 1px solid #f5c6cb;
      }
      
      .loading {
          text-align: center;
          padding: 20px;
          color: #586069;
      }
      
      @media (max-width: 768px) {
          .container {
              margin: 10px;
          }
          
          .content {
              padding: 20px;
          }
          
          .header {
              padding: 20px;
          }
          
          .header h1 {
              font-size: 2em;
          }
      }
  </style>
</head>
<body>
  <div class="container">
      <div class="header">
          <h1>🎬 Firebase 影片資料庫</h1>
          <p>簡單管理你的影片收藏</p>
      </div>
      
      <div class="content">
          <!-- 新增影片區域 -->
          <div class="section">
              <h2>📝 新增影片</h2>
              <form id="addVideoForm">
                  <div class="form-group">
                      <label for="videoId">🆔 影片 ID</label>
                      <input type="number" id="videoId" name="videoId" required placeholder="例如：89">
                  </div>
                  
                  <div class="form-group">
                      <label for="videoTitle">📹 影片標題</label>
                      <input type="text" id="videoTitle" name="videoTitle" required placeholder="例如：失火啦">
                  </div>
                  
                  <div class="form-group">
                      <label for="videoSrc">🔗 影片來源網址</label>
                      <input type="url" id="videoSrc" name="videoSrc" required placeholder="例如：https://player.vimeo.com/video/...">
                  </div>
                  
                  <div class="form-group">
                      <label for="videoTags">🏷️ 標籤</label>
                      <div class="tags-input" id="tagsContainer">
                          <input type="text" class="tag-input" id="tagInput" placeholder="輸入標籤後按 Enter">
                      </div>
                      <small style="color: #586069; margin-top: 5px; display: block;">
                          💡 輸入標籤後按 Enter 鍵新增
                      </small>
                  </div>
                  
                  <button type="submit" class="btn btn-primary">➕ 新增影片</button>
                  <button type="button" class="btn btn-secondary" onclick="clearForm()">🗑️ 清除表單</button>
              </form>
              
              <div id="addAlert"></div>
          </div>
          
          <!-- 影片列表區域 -->
          <div class="section">
              <h2>📋 影片列表</h2>
              <button class="btn btn-primary" onclick="loadVideos()">🔄 重新載入</button>
              <button class="btn btn-danger" onclick="clearAllVideos()">🗑️ 清空所有影片</button>
              
              <div id="videosList">
                  <div class="loading">正在載入影片...</div>
              </div>
              
              <div id="listAlert"></div>
          </div>
      </div>
  </div>

  <script type="module">
      // Import Firebase SDK
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
      import { getFirestore, collection, addDoc, getDocs, doc, deleteDoc, query, orderBy, writeBatch } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";
      
      // Firebase 設定
      const firebaseConfig = {
          apiKey: "AIzaSyDLzkPHjt93YHhsgcdhV5NAoeeIgD1hlRI",
          authDomain: "my-video-database-a8054.firebaseapp.com",
          projectId: "my-video-database-a8054",
          storageBucket: "my-video-database-a8054.firebasestorage.app",
          messagingSenderId: "876492351818",
          appId: "1:876492351818:web:60f57dab840c1c5bd439b3",
          measurementId: "G-PGB95QQV5S"
      };
      
      // 初始化 Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      
      console.log('🔥 Firebase 已連接');
      
      // 全域變數
      let selectedTags = [];
      
      // 顯示提示訊息
      function showAlert(containerId, type, message) {
          const container = document.getElementById(containerId);
          container.innerHTML = `<div class="alert ${type}">${message}</div>`;
          setTimeout(() => {
              container.innerHTML = '';
          }, 5000);
      }
      
      // 新增標籤
      function addTag() {
          const tagInput = document.getElementById('tagInput');
          const tagValue = tagInput.value.trim();
          
          if (tagValue && !selectedTags.includes(tagValue)) {
              selectedTags.push(tagValue);
              renderTags();
              tagInput.value = '';
          }
      }
      
      // 移除標籤
      function removeTag(tagToRemove) {
          selectedTags = selectedTags.filter(tag => tag !== tagToRemove);
          renderTags();
      }
      
      // 渲染標籤
      function renderTags() {
          const container = document.getElementById('tagsContainer');
          const tagInput = document.getElementById('tagInput');
          
          container.innerHTML = '';
          
          selectedTags.forEach(tag => {
              const tagElement = document.createElement('div');
              tagElement.className = 'tag';
              tagElement.innerHTML = `
                  ${tag}
                  <button type="button" class="tag-remove" onclick="removeTag('${tag}')">×</button>
              `;
              container.appendChild(tagElement);
          });
          
          container.appendChild(tagInput);
      }
      
      // 清除表單
      window.clearForm = function() {
          document.getElementById('addVideoForm').reset();
          selectedTags = [];
          renderTags();
      }
      
      // 新增影片
      async function handleAddVideo(e) {
          e.preventDefault();
          
          const formData = new FormData(e.target);
          const videoData = {
              id: parseInt(formData.get('videoId')),
              title: formData.get('videoTitle').trim(),
              src: formData.get('videoSrc').trim(),
              tags: selectedTags,
              createdAt: new Date()
          };
          
          // 簡單驗證
          if (!videoData.id || !videoData.title || !videoData.src) {
              showAlert('addAlert', 'error', '❌ 請填寫所有必填欄位');
              return;
          }
          
          try {
              await addDoc(collection(db, 'videos'), videoData);
              showAlert('addAlert', 'success', '🎉 影片新增成功！');
              clearForm();
              loadVideos(); // 重新載入列表
          } catch (error) {
              console.error('新增影片失敗:', error);
              showAlert('addAlert', 'error', '❌ 新增影片失敗：' + error.message);
          }
      }
      
      // 載入影片列表
      window.loadVideos = async function() {
          const videosList = document.getElementById('videosList');
          videosList.innerHTML = '<div class="loading">正在載入影片...</div>';
          
          try {
              const videosRef = collection(db, 'videos');
              const q = query(videosRef, orderBy('id', 'desc'));
              const querySnapshot = await getDocs(q);
              
              if (querySnapshot.empty) {
                  videosList.innerHTML = '<div style="text-align: center; padding: 40px; color: #586069;">📝 還沒有任何影片，快新增第一個吧！</div>';
                  return;
              }
              
              let videosHtml = '<div class="video-list">';
              querySnapshot.forEach((doc) => {
                  const video = doc.data();
                  const tagsHtml = video.tags ? video.tags.map(tag => 
                      `<span class="video-tag">${tag}</span>`
                  ).join('') : '';
                  
                  videosHtml += `
                      <div class="video-item">
                          <div class="video-title">${video.title}</div>
                          <div class="video-id">ID: ${video.id}</div>
                          <div class="video-src">🔗 <a href="${video.src}" target="_blank">${video.src}</a></div>
                          <div class="video-tags">${tagsHtml}</div>
                          <button class="btn btn-danger" onclick="deleteVideo('${doc.id}')">🗑️ 刪除</button>
                      </div>
                  `;
              });
              videosHtml += '</div>';
              
              videosList.innerHTML = videosHtml;
              
          } catch (error) {
              console.error('載入影片失敗:', error);
              videosList.innerHTML = '<div class="alert error">❌ 載入影片失敗：' + error.message + '</div>';
          }
      }
      
      // 刪除單個影片
      window.deleteVideo = async function(docId) {
          if (!confirm('確定要刪除這個影片嗎？')) {
              return;
          }
          
          try {
              await deleteDoc(doc(db, 'videos', docId));
              showAlert('listAlert', 'success', '🗑️ 影片已刪除');
              loadVideos(); // 重新載入列表
          } catch (error) {
              console.error('刪除影片失敗:', error);
              showAlert('listAlert', 'error', '❌ 刪除影片失敗：' + error.message);
          }
      }
      
      // 清空所有影片
      window.clearAllVideos = async function() {
          if (!confirm('⚠️ 確定要刪除所有影片嗎？此操作無法復原！')) {
              return;
          }
          
          try {
              const videosRef = collection(db, 'videos');
              const snapshot = await getDocs(videosRef);
              
              if (snapshot.empty) {
                  showAlert('listAlert', 'error', '📝 沒有影片可以刪除');
                  return;
              }
              
              const batch = writeBatch(db);
              snapshot.docs.forEach((doc) => {
                  batch.delete(doc.ref);
              });
              
              await batch.commit();
              showAlert('listAlert', 'success', '🗑️ 所有影片已清空');
              loadVideos(); // 重新載入列表
              
          } catch (error) {
              console.error('清空影片失敗:', error);
              showAlert('listAlert', 'error', '❌ 清空影片失敗：' + error.message);
          }
      }
      
      // 綁定事件
      document.getElementById('addVideoForm').addEventListener('submit', handleAddVideo);
      
      // 標籤輸入事件
      document.getElementById('tagInput').addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
              e.preventDefault();
              addTag();
          }
      });
      
      // 點擊標籤容器聚焦輸入框
      document.getElementById('tagsContainer').addEventListener('click', () => {
          document.getElementById('tagInput').focus();
      });
      
      // 頁面載入時自動載入影片
      loadVideos();
      
      // 讓函數可以在全域使用
      window.removeTag = removeTag;
  </script>
</body>
</html>
