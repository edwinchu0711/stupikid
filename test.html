<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GitHub Actions 留言板</title>
  <style>
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }
      
      body {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          min-height: 100vh;
          padding: 20px;
      }
      
      .container {
          max-width: 900px;
          margin: 0 auto;
          background: white;
          border-radius: 15px;
          box-shadow: 0 10px 30px rgba(0,0,0,0.2);
          overflow: hidden;
      }
      
      .header {
          background: linear-gradient(45deg, #24292e, #586069);
          color: white;
          padding: 40px 30px;
          text-align: center;
      }
      
      .header h1 {
          font-size: 2.8em;
          margin-bottom: 10px;
          background: linear-gradient(45deg, #fff, #f0f6ff);
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
      }
      
      .header p {
          opacity: 0.9;
          font-size: 1.2em;
      }
      
      .stats {
          display: flex;
          justify-content: center;
          gap: 30px;
          margin-top: 20px;
      }
      
      .stat-item {
          text-align: center;
      }
      
      .stat-number {
          font-size: 2em;
          font-weight: bold;
          color: #4CAF50;
      }
      
      .stat-label {
          font-size: 0.9em;
          opacity: 0.8;
      }
      
      .form-section {
          padding: 40px 30px;
          background: linear-gradient(135deg, #f8f9fa, #e9ecef);
          border-bottom: 1px solid #dee2e6;
      }
      
      .form-title {
          text-align: center;
          margin-bottom: 30px;
          color: #24292e;
          font-size: 1.8em;
      }
      
      .form-grid {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 20px;
          margin-bottom: 20px;
      }
      
      .form-group {
          margin-bottom: 20px;
      }
      
      .form-group.full-width {
          grid-column: 1 / -1;
      }
      
      .form-group label {
          display: block;
          margin-bottom: 8px;
          font-weight: 600;
          color: #24292e;
          font-size: 1.1em;
      }
      
      .form-group input,
      .form-group textarea {
          width: 100%;
          padding: 15px 18px;
          border: 2px solid #e1e4e8;
          border-radius: 10px;
          font-size: 16px;
          transition: all 0.3s ease;
          font-family: inherit;
      }
      
      .form-group input:focus,
      .form-group textarea:focus {
          outline: none;
          border-color: #0366d6;
          box-shadow: 0 0 0 4px rgba(3, 102, 214, 0.1);
          transform: translateY(-2px);
      }
      
      .form-group textarea {
          resize: vertical;
          min-height: 150px;
          line-height: 1.6;
      }
      
      .submit-btn {
          background: linear-gradient(45deg, #28a745, #20c997);
          color: white;
          padding: 15px 40px;
          border: none;
          border-radius: 10px;
          font-size: 18px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s ease;
          display: block;
          margin: 0 auto;
          position: relative;
          overflow: hidden;
      }
      
      .submit-btn:hover {
          transform: translateY(-3px);
          box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
      }
      
      .submit-btn:active {
          transform: translateY(-1px);
      }
      
      .submit-btn.loading {
          pointer-events: none;
          opacity: 0.8;
      }
      
      .submit-btn.loading::after {
          content: '';
          position: absolute;
          top: 50%;
          left: 50%;
          width: 20px;
          height: 20px;
          margin: -10px 0 0 -10px;
          border: 2px solid transparent;
          border-top: 2px solid white;
          border-radius: 50%;
          animation: spin 1s linear infinite;
      }
      
      @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
      }
      
      .messages-section {
          padding: 40px 30px;
      }
      
      .messages-title {
          text-align: center;
          margin-bottom: 30px;
          color: #24292e;
          font-size: 1.8em;
      }
      
      .message {
          background: linear-gradient(135deg, #ffffff, #f8f9fa);
          border: 1px solid #e1e4e8;
          border-radius: 15px;
          padding: 25px;
          margin-bottom: 25px;
          box-shadow: 0 4px 15px rgba(0,0,0,0.08);
          transition: all 0.3s ease;
          position: relative;
          overflow: hidden;
      }
      
      .message::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          width: 4px;
          height: 100%;
          background: linear-gradient(45deg, #667eea, #764ba2);
      }
      
      .message:hover {
          transform: translateY(-5px);
          box-shadow: 0 8px 30px rgba(0,0,0,0.15);
      }
      
      .message-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 15px;
          padding-bottom: 15px;
          border-bottom: 2px solid #f1f3f4;
      }
      
      .message-author {
          font-weight: 700;
          color: #0366d6;
          font-size: 1.2em;
      }
      
      .message-date {
          color: #586069;
          font-size: 0.95em;
          background: #f1f3f4;
          padding: 5px 12px;
          border-radius: 20px;
      }
      
      .message-content {
          color: #24292e;
          line-height: 1.8;
          font-size: 1.05em;
          word-wrap: break-word;
      }
      
      .loading-spinner {
          text-align: center;
          padding: 40px;
          color: #586069;
      }
      
      .loading-spinner::after {
          content: '';
          display: inline-block;
          width: 30px;
          height: 30px;
          border: 3px solid #f3f3f3;
          border-top: 3px solid #0366d6;
          border-radius: 50%;
          animation: spin 1s linear infinite;
          margin-left: 10px;
      }
      
      .no-messages {
          text-align: center;
          color: #586069;
          font-style: italic;
          padding: 60px;
          font-size: 1.2em;
      }
      
      .alert {
          padding: 15px 20px;
          margin: 20px 0;
          border-radius: 8px;
          font-weight: 500;
      }
      
      .alert.success {
          background: #d4edda;
          color: #155724;
          border: 1px solid #c3e6cb;
      }
      
      .alert.error {
          background: #f8d7da;
          color: #721c24;
          border: 1px solid #f5c6cb;
      }
      
      .github-info {
          background: linear-gradient(135deg, #f1f8ff, #e1f5fe);
          border: 2px solid #c8e1ff;
          border-radius: 12px;
          padding: 25px;
          margin: 30px;
          text-align: center;
      }
      
      .github-info h3 {
          color: #0366d6;
          margin-bottom: 15px;
          font-size: 1.4em;
      }
      
      .github-info p {
          color: #586069;
          margin-bottom: 20px;
          line-height: 1.6;
      }
      
      .github-link {
          display: inline-block;
          background: linear-gradient(45deg, #0366d6, #0256cc);
          color: white;
          padding: 12px 25px;
          text-decoration: none;
          border-radius: 8px;
          font-weight: 600;
          transition: all 0.3s ease;
      }
      
      .github-link:hover {
          transform: translateY(-2px);
          box-shadow: 0 5px 15px rgba(3, 102, 214, 0.3);
      }
      
      @media (max-width: 768px) {
          .container {
              margin: 10px;
              border-radius: 10px;
          }
          
          .header {
              padding: 30px 20px;
          }
          
          .header h1 {
              font-size: 2.2em;
          }
          
          .stats {
              gap: 20px;
          }
          
          .form-section,
          .messages-section {
              padding: 30px 20px;
          }
          
          .form-grid {
              grid-template-columns: 1fr;
              gap: 15px;
          }
          
          .github-info {
              margin: 20px;
              padding: 20px;
          }
      }
  </style>
</head>
<body>
  <div class="container">
      <div class="header">
          <h1>🚀 GitHub Actions 留言板</h1>
          <p>使用 GitHub Actions 自動化處理的現代留言系統</p>
          <div class="stats">
              <div class="stat-item">
                  <div class="stat-number" id="messageCount">0</div>
                  <div class="stat-label">總留言數</div>
              </div>
              <div class="stat-item">
                  <div class="stat-number" id="todayCount">0</div>
                  <div class="stat-label">今日留言</div>
              </div>
          </div>
      </div>
      
      <div class="github-info">
          <h3>⚡ 技術特色</h3>
          <p>這個留言板使用 GitHub Actions 自動化工作流程，將留言儲存為 JSON 格式，並透過 GitHub Pages 展示。完全免費且開源！</p>
          <a href="https://github.com/你的用戶名/你的倉庫名" class="github-link" target="_blank">
              查看原始碼 →
          </a>
      </div>
      
      <div class="form-section">
          <h2 class="form-title">💬 發表留言</h2>
          <form id="messageForm">
              <div class="form-grid">
                  <div class="form-group">
                      <label for="name">👤 姓名 *</label>
                      <input type="text" id="name" name="name" required placeholder="請輸入你的姓名" maxlength="50">
                  </div>
                  
                  <div class="form-group">
                      <label for="email">📧 Email (選填)</label>
                      <input type="email" id="email" name="email" placeholder="your@email.com" maxlength="100">
                  </div>
              </div>
              
              <div class="form-group full-width">
                  <label for="message">💭 留言內容 *</label>
                  <textarea id="message" name="message" required placeholder="請輸入你的留言內容..." maxlength="1000"></textarea>
              </div>
              
              <button type="submit" class="submit-btn" id="submitBtn">
                  📤 送出留言
              </button>
          </form>
          
          <div id="alertContainer"></div>
      </div>
      
      <div class="messages-section">
          <h2 class="messages-title">💭 最新留言</h2>
          <div id="messagesList">
              <div class="loading-spinner">載入留言中...</div>
          </div>
      </div>
  </div>
  
  <script>
      class GuestBook {
          constructor() {
              this.form = document.getElementById('messageForm');
              this.messagesList = document.getElementById('messagesList');
              this.submitBtn = document.getElementById('submitBtn');
              this.alertContainer = document.getElementById('alertContainer');
              
              this.init();
          }
          
          init() {
              this.loadMessages();
              this.bindEvents();
          }
          
          bindEvents() {
              this.form.addEventListener('submit', (e) => this.handleSubmit(e));
          }
          
          async loadMessages() {
              try {
                  // 從 GitHub Pages 載入留言資料
                  const response = await fetch('./data/messages.json?t=' + Date.now());
                  const data = await response.json();
                  
                  this.renderMessages(data.messages);
                  this.updateStats(data.messages);
              } catch (error) {
                  console.error('載入留言失敗:', error);
                  this.messagesList.innerHTML = `
                      <div class="no-messages">
                          ❌ 載入留言失敗，請稍後再試
                      </div>
                  `;
              }
          }
          
          renderMessages(messages) {
              if (!messages || messages.length === 0) {
                  this.messagesList.innerHTML = `
                      <div class="no-messages">
                          📝 還沒有留言，成為第一個留言的人吧！
                      </div>
                  `;
                  return;
              }
              
              // 按時間倒序排列
              const sortedMessages = messages
                  .filter(msg => msg.approved !== false)
                  .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
              
              this.messagesList.innerHTML = sortedMessages
                  .map(message => this.createMessageHTML(message))
                  .join('');
          }
          
          createMessageHTML(message) {
              const date = new Date(message.timestamp);
              const formattedDate = date.toLocaleString('zh-TW', {
                  year: 'numeric',
                  month: '2-digit',
                  day: '2-digit',
                  hour: '2-digit',
                  minute: '2-digit'
              });
              
              return `
                  <div class="message">
                      <div class="message-header">
                          <span class="message-author">${this.escapeHtml(message.name)}</span>
                          <span class="message-date">${formattedDate}</span>
                      </div>
                      <div class="message-content">${this.escapeHtml(message.message).replace(/\n/g, '<br>')}</div>
                  </div>
              `;
          }
          
          updateStats(messages) {
              const approvedMessages = messages.filter(msg => msg.approved !== false);
              document.getElementById('messageCount').textContent = approvedMessages.length;
              
              const today = new Date().toDateString();
              const todayMessages = approvedMessages.filter(msg => 
                  new Date(msg.timestamp).toDateString() === today
              );
              document.getElementById('todayCount').textContent = todayMessages.length;
          }
          
          async handleSubmit(e) {
              e.preventDefault();
              
              const formData = new FormData(this.form);
              const messageData = {
                  name: formData.get('name').trim(),
                  email: formData.get('email').trim(),
                  message: formData.get('message').trim()
              };
              
              // 驗證資料
              if (!this.validateMessage(messageData)) {
                  return;
              }
              
              this.setLoading(true);
              
              try {
                  // 在實際應用中，這裡會透過 GitHub API 或 webhook 提交資料
                  await this.submitMessage(messageData);
                  
                  this.showAlert('success', '✅ 留言提交成功！留言將在審核後顯示。');
                  this.form.reset();
                  
                  // 3秒後重新載入留言
                  setTimeout(() => {
                      this.loadMessages();
                  }, 3000);
                  
              } catch (error) {
                  console.error('提交留言失敗:', error);
                  this.showAlert('error', '❌ 提交失敗，請稍後再試。');
              }
              
              this.setLoading(false);
          }
          
          async submitMessage(messageData) {
              // 模擬 API 呼叫
              // 在實際應用中，這裡會：
              // 1. 呼叫 GitHub API 建立 Issue
              // 2. 或者透過 webhook 觸發 GitHub Actions
              // 3. 或者使用第三方服務如 Netlify Forms
              
              return new Promise((resolve, reject) => {
                  setTimeout(() => {
                      // 模擬成功/失敗
                      if (Math.random() > 0.1) {
                          resolve();
                      } else {
                          reject(new Error('模擬錯誤'));
                      }
                  }, 2000);
              });
          }
          
          validateMessage(data) {
              if (!data.name || data.name.length < 2) {
                  this.showAlert('error', '❌ 請輸入至少 2 個字元的姓名');
                  return false;
              }
              
              if (!data.message || data.message.length < 5) {
                  this.showAlert('error', '❌ 留言內容至少需要 5 個字元');
                  return false;
              }
              
              if (data.email && !this.isValidEmail(data.email)) {
                  this.showAlert('error', '❌ 請輸入有效的 Email 地址');
                  return false;
              }
              
              return true;
          }
          
          isValidEmail(email) {
              const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
              return emailRegex.test(email);
          }
          
          setLoading(loading) {
              if (loading) {
                  this.submitBtn.classList.add('loading');
                  this.submitBtn.textContent = '提交中...';
                  this.submitBtn.disabled = true;
              } else {
                  this.submitBtn.classList.remove('loading');
                  this.submitBtn.textContent = '📤 送出留言';
                  this.submitBtn.disabled = false;
              }
          }
          
          showAlert(type, message) {
              this.alertContainer.innerHTML = `
                  <div class="alert ${type}">
                      ${message}
                  </div>
              `;
              
              // 5秒後自動隱藏
              setTimeout(() => {
                  this.alertContainer.innerHTML = '';
              }, 5000);
          }
          
          escapeHtml(text) {
              const div = document.createElement('div');
              div.textContent = text;
              return div.innerHTML;
          }
      }
      
      // 初始化留言板
      document.addEventListener('DOMContentLoaded', () => {
          new GuestBook();
      });
  </script>
</body>
</html>
