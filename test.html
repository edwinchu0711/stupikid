<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase å½±ç‰‡è³‡æ–™åº«</title>
  <style>
      * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
      }
      
      body {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
          min-height: 100vh;
          padding: 20px;
      }
      
      .container {
          max-width: 800px;
          margin: 0 auto;
          background: white;
          border-radius: 15px;
          box-shadow: 0 10px 30px rgba(0,0,0,0.2);
          overflow: hidden;
      }
      
      .header {
          background: linear-gradient(45deg, #FF6B35, #F7931E);
          color: white;
          padding: 30px;
          text-align: center;
      }
      
      .header h1 {
          font-size: 2.5em;
          margin-bottom: 10px;
      }
      
      .content {
          padding: 30px;
      }
      
      .section {
          margin-bottom: 40px;
          padding: 20px;
          background: #f8f9fa;
          border-radius: 10px;
          border-left: 4px solid #FF6B35;
      }
      
      .section h2 {
          color: #24292e;
          margin-bottom: 20px;
          font-size: 1.5em;
      }
      
      .form-group {
          margin-bottom: 20px;
      }
      
      .form-group label {
          display: block;
          margin-bottom: 8px;
          font-weight: 600;
          color: #24292e;
      }
      
      .form-group input,
      .form-group textarea {
          width: 100%;
          padding: 12px 15px;
          border: 2px solid #e1e4e8;
          border-radius: 8px;
          font-size: 16px;
          transition: all 0.3s ease;
      }
      
      .form-group input:focus,
      .form-group textarea:focus {
          outline: none;
          border-color: #FF6B35;
          box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
      }
      
      .tags-input {
          display: flex;
          flex-wrap: wrap;
          gap: 8px;
          padding: 10px;
          border: 2px solid #e1e4e8;
          border-radius: 8px;
          min-height: 50px;
          cursor: text;
      }
      
      .tags-input:focus-within {
          border-color: #FF6B35;
          box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
      }
      
      .tag {
          background: linear-gradient(45deg, #FF6B35, #F7931E);
          color: white;
          padding: 5px 12px;
          border-radius: 20px;
          font-size: 14px;
          display: flex;
          align-items: center;
          gap: 5px;
      }
      
      .tag-remove {
          background: rgba(255,255,255,0.3);
          border: none;
          color: white;
          border-radius: 50%;
          width: 18px;
          height: 18px;
          cursor: pointer;
          font-size: 12px;
          display: flex;
          align-items: center;
          justify-content: center;
      }
      
      .tag-input {
          border: none;
          outline: none;
          flex: 1;
          min-width: 120px;
          padding: 8px;
          font-size: 16px;
      }
      
      .btn {
          padding: 12px 25px;
          border: none;
          border-radius: 8px;
          font-size: 16px;
          font-weight: 600;
          cursor: pointer;
          transition: all 0.3s ease;
          margin-right: 10px;
          margin-bottom: 10px;
      }
      
      .btn-primary {
          background: linear-gradient(45deg, #FF6B35, #F7931E);
          color: white;
      }
      
      .btn-primary:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 20px rgba(255, 107, 53, 0.3);
      }
      
      .btn-secondary {
          background: linear-gradient(45deg, #6c757d, #5a6268);
          color: white;
      }
      
      .btn-secondary:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 20px rgba(108, 117, 125, 0.3);
      }
      
      .btn-danger {
          background: linear-gradient(45deg, #dc3545, #c82333);
          color: white;
      }
      
      .btn-danger:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 20px rgba(220, 53, 69, 0.3);
      }
      
      .video-list {
          display: grid;
          gap: 20px;
      }
      
      .video-item {
          background: white;
          border: 1px solid #e1e4e8;
          border-radius: 10px;
          padding: 20px;
          box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      }
      
      .video-title {
          font-size: 1.3em;
          font-weight: 600;
          color: #24292e;
          margin-bottom: 10px;
      }
      
      .video-id {
          font-size: 0.9em;
          color: #586069;
          margin-bottom: 10px;
      }
      
      .video-src {
          font-size: 0.9em;
          color: #0366d6;
          margin-bottom: 15px;
          word-break: break-all;
      }
      
      .video-tags {
          display: flex;
          flex-wrap: wrap;
          gap: 5px;
          margin-bottom: 15px;
      }
      
      .video-tag {
          background: #f1f8ff;
          color: #0366d6;
          padding: 3px 8px;
          border-radius: 12px;
          font-size: 12px;
          border: 1px solid #c8e1ff;
      }
      
      .alert {
          padding: 15px 20px;
          margin: 20px 0;
          border-radius: 8px;
          font-weight: 500;
      }
      
      .alert.success {
          background: #d4edda;
          color: #155724;
          border: 1px solid #c3e6cb;
      }
      
      .alert.error {
          background: #f8d7da;
          color: #721c24;
          border: 1px solid #f5c6cb;
      }
      
      .loading {
          text-align: center;
          padding: 20px;
          color: #586069;
      }
      
      @media (max-width: 768px) {
          .container {
              margin: 10px;
          }
          
          .content {
              padding: 20px;
          }
          
          .header {
              padding: 20px;
          }
          
          .header h1 {
              font-size: 2em;
          }
      }
  </style>
</head>
<body>
  <div class="container">
      <div class="header">
          <h1>ğŸ¬ Firebase å½±ç‰‡è³‡æ–™åº«</h1>
          <p>ç°¡å–®ç®¡ç†ä½ çš„å½±ç‰‡æ”¶è—</p>
      </div>
      
      <div class="content">
          <!-- æ–°å¢å½±ç‰‡å€åŸŸ -->
          <div class="section">
              <h2>ğŸ“ æ–°å¢å½±ç‰‡</h2>
              <form id="addVideoForm">
                  <div class="form-group">
                      <label for="videoId">ğŸ†” å½±ç‰‡ ID</label>
                      <input type="number" id="videoId" name="videoId" required placeholder="ä¾‹å¦‚ï¼š89">
                  </div>
                  
                  <div class="form-group">
                      <label for="videoTitle">ğŸ“¹ å½±ç‰‡æ¨™é¡Œ</label>
                      <input type="text" id="videoTitle" name="videoTitle" required placeholder="ä¾‹å¦‚ï¼šå¤±ç«å•¦">
                  </div>
                  
                  <div class="form-group">
                      <label for="videoSrc">ğŸ”— å½±ç‰‡ä¾†æºç¶²å€</label>
                      <input type="url" id="videoSrc" name="videoSrc" required placeholder="ä¾‹å¦‚ï¼šhttps://player.vimeo.com/video/...">
                  </div>
                  
                  <div class="form-group">
                      <label for="videoTags">ğŸ·ï¸ æ¨™ç±¤</label>
                      <div class="tags-input" id="tagsContainer">
                          <input type="text" class="tag-input" id="tagInput" placeholder="è¼¸å…¥æ¨™ç±¤å¾ŒæŒ‰ Enter">
                      </div>
                      <small style="color: #586069; margin-top: 5px; display: block;">
                          ğŸ’¡ è¼¸å…¥æ¨™ç±¤å¾ŒæŒ‰ Enter éµæ–°å¢
                      </small>
                  </div>
                  
                  <button type="submit" class="btn btn-primary">â• æ–°å¢å½±ç‰‡</button>
                  <button type="button" class="btn btn-secondary" onclick="clearForm()">ğŸ—‘ï¸ æ¸…é™¤è¡¨å–®</button>
              </form>
              
              <div id="addAlert"></div>
          </div>
          
          <!-- å½±ç‰‡åˆ—è¡¨å€åŸŸ -->
          <div class="section">
              <h2>ğŸ“‹ å½±ç‰‡åˆ—è¡¨</h2>
              <button class="btn btn-primary" onclick="loadVideos()">ğŸ”„ é‡æ–°è¼‰å…¥</button>
              <button class="btn btn-danger" onclick="clearAllVideos()">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰å½±ç‰‡</button>
              
              <div id="videosList">
                  <div class="loading">æ­£åœ¨è¼‰å…¥å½±ç‰‡...</div>
              </div>
              
              <div id="listAlert"></div>
          </div>
      </div>
  </div>

  <script type="module">
      // Import Firebase SDK
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
      import { getFirestore, collection, addDoc, getDocs, doc, deleteDoc, query, orderBy, writeBatch } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";
      
      // Firebase è¨­å®š
      const firebaseConfig = {
          apiKey: "AIzaSyDLzkPHjt93YHhsgcdhV5NAoeeIgD1hlRI",
          authDomain: "my-video-database-a8054.firebaseapp.com",
          projectId: "my-video-database-a8054",
          storageBucket: "my-video-database-a8054.firebasestorage.app",
          messagingSenderId: "876492351818",
          appId: "1:876492351818:web:60f57dab840c1c5bd439b3",
          measurementId: "G-PGB95QQV5S"
      };
      
      // åˆå§‹åŒ– Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      
      console.log('ğŸ”¥ Firebase å·²é€£æ¥');
      
      // å…¨åŸŸè®Šæ•¸
      let selectedTags = [];
      
      // é¡¯ç¤ºæç¤ºè¨Šæ¯
      function showAlert(containerId, type, message) {
          const container = document.getElementById(containerId);
          container.innerHTML = `<div class="alert ${type}">${message}</div>`;
          setTimeout(() => {
              container.innerHTML = '';
          }, 5000);
      }
      
      // æ–°å¢æ¨™ç±¤
      function addTag() {
          const tagInput = document.getElementById('tagInput');
          const tagValue = tagInput.value.trim();
          
          if (tagValue && !selectedTags.includes(tagValue)) {
              selectedTags.push(tagValue);
              renderTags();
              tagInput.value = '';
          }
      }
      
      // ç§»é™¤æ¨™ç±¤
      function removeTag(tagToRemove) {
          selectedTags = selectedTags.filter(tag => tag !== tagToRemove);
          renderTags();
      }
      
      // æ¸²æŸ“æ¨™ç±¤
      function renderTags() {
          const container = document.getElementById('tagsContainer');
          const tagInput = document.getElementById('tagInput');
          
          container.innerHTML = '';
          
          selectedTags.forEach(tag => {
              const tagElement = document.createElement('div');
              tagElement.className = 'tag';
              tagElement.innerHTML = `
                  ${tag}
                  <button type="button" class="tag-remove" onclick="removeTag('${tag}')">Ã—</button>
              `;
              container.appendChild(tagElement);
          });
          
          container.appendChild(tagInput);
      }
      
      // æ¸…é™¤è¡¨å–®
      window.clearForm = function() {
          document.getElementById('addVideoForm').reset();
          selectedTags = [];
          renderTags();
      }
      
      // æ–°å¢å½±ç‰‡
      async function handleAddVideo(e) {
          e.preventDefault();
          
          const formData = new FormData(e.target);
          const videoData = {
              id: parseInt(formData.get('videoId')),
              title: formData.get('videoTitle').trim(),
              src: formData.get('videoSrc').trim(),
              tags: selectedTags,
              createdAt: new Date()
          };
          
          // ç°¡å–®é©—è­‰
          if (!videoData.id || !videoData.title || !videoData.src) {
              showAlert('addAlert', 'error', 'âŒ è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½');
              return;
          }
          
          try {
              await addDoc(collection(db, 'videos'), videoData);
              showAlert('addAlert', 'success', 'ğŸ‰ å½±ç‰‡æ–°å¢æˆåŠŸï¼');
              clearForm();
              loadVideos(); // é‡æ–°è¼‰å…¥åˆ—è¡¨
          } catch (error) {
              console.error('æ–°å¢å½±ç‰‡å¤±æ•—:', error);
              showAlert('addAlert', 'error', 'âŒ æ–°å¢å½±ç‰‡å¤±æ•—ï¼š' + error.message);
          }
      }
      
      // è¼‰å…¥å½±ç‰‡åˆ—è¡¨
      window.loadVideos = async function() {
          const videosList = document.getElementById('videosList');
          videosList.innerHTML = '<div class="loading">æ­£åœ¨è¼‰å…¥å½±ç‰‡...</div>';
          
          try {
              const videosRef = collection(db, 'videos');
              const q = query(videosRef, orderBy('id', 'desc'));
              const querySnapshot = await getDocs(q);
              
              if (querySnapshot.empty) {
                  videosList.innerHTML = '<div style="text-align: center; padding: 40px; color: #586069;">ğŸ“ é‚„æ²’æœ‰ä»»ä½•å½±ç‰‡ï¼Œå¿«æ–°å¢ç¬¬ä¸€å€‹å§ï¼</div>';
                  return;
              }
              
              let videosHtml = '<div class="video-list">';
              querySnapshot.forEach((doc) => {
                  const video = doc.data();
                  const tagsHtml = video.tags ? video.tags.map(tag => 
                      `<span class="video-tag">${tag}</span>`
                  ).join('') : '';
                  
                  videosHtml += `
                      <div class="video-item">
                          <div class="video-title">${video.title}</div>
                          <div class="video-id">ID: ${video.id}</div>
                          <div class="video-src">ğŸ”— <a href="${video.src}" target="_blank">${video.src}</a></div>
                          <div class="video-tags">${tagsHtml}</div>
                          <button class="btn btn-danger" onclick="deleteVideo('${doc.id}')">ğŸ—‘ï¸ åˆªé™¤</button>
                      </div>
                  `;
              });
              videosHtml += '</div>';
              
              videosList.innerHTML = videosHtml;
              
          } catch (error) {
              console.error('è¼‰å…¥å½±ç‰‡å¤±æ•—:', error);
              videosList.innerHTML = '<div class="alert error">âŒ è¼‰å…¥å½±ç‰‡å¤±æ•—ï¼š' + error.message + '</div>';
          }
      }
      
      // åˆªé™¤å–®å€‹å½±ç‰‡
      window.deleteVideo = async function(docId) {
          if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹å½±ç‰‡å—ï¼Ÿ')) {
              return;
          }
          
          try {
              await deleteDoc(doc(db, 'videos', docId));
              showAlert('listAlert', 'success', 'ğŸ—‘ï¸ å½±ç‰‡å·²åˆªé™¤');
              loadVideos(); // é‡æ–°è¼‰å…¥åˆ—è¡¨
          } catch (error) {
              console.error('åˆªé™¤å½±ç‰‡å¤±æ•—:', error);
              showAlert('listAlert', 'error', 'âŒ åˆªé™¤å½±ç‰‡å¤±æ•—ï¼š' + error.message);
          }
      }
      
      // æ¸…ç©ºæ‰€æœ‰å½±ç‰‡
      window.clearAllVideos = async function() {
          if (!confirm('âš ï¸ ç¢ºå®šè¦åˆªé™¤æ‰€æœ‰å½±ç‰‡å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
              return;
          }
          
          try {
              const videosRef = collection(db, 'videos');
              const snapshot = await getDocs(videosRef);
              
              if (snapshot.empty) {
                  showAlert('listAlert', 'error', 'ğŸ“ æ²’æœ‰å½±ç‰‡å¯ä»¥åˆªé™¤');
                  return;
              }
              
              const batch = writeBatch(db);
              snapshot.docs.forEach((doc) => {
                  batch.delete(doc.ref);
              });
              
              await batch.commit();
              showAlert('listAlert', 'success', 'ğŸ—‘ï¸ æ‰€æœ‰å½±ç‰‡å·²æ¸…ç©º');
              loadVideos(); // é‡æ–°è¼‰å…¥åˆ—è¡¨
              
          } catch (error) {
              console.error('æ¸…ç©ºå½±ç‰‡å¤±æ•—:', error);
              showAlert('listAlert', 'error', 'âŒ æ¸…ç©ºå½±ç‰‡å¤±æ•—ï¼š' + error.message);
          }
      }
      
      // ç¶å®šäº‹ä»¶
      document.getElementById('addVideoForm').addEventListener('submit', handleAddVideo);
      
      // æ¨™ç±¤è¼¸å…¥äº‹ä»¶
      document.getElementById('tagInput').addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
              e.preventDefault();
              addTag();
          }
      });
      
      // é»æ“Šæ¨™ç±¤å®¹å™¨èšç„¦è¼¸å…¥æ¡†
      document.getElementById('tagsContainer').addEventListener('click', () => {
          document.getElementById('tagInput').focus();
      });
      
      // é é¢è¼‰å…¥æ™‚è‡ªå‹•è¼‰å…¥å½±ç‰‡
      loadVideos();
      
      // è®“å‡½æ•¸å¯ä»¥åœ¨å…¨åŸŸä½¿ç”¨
      window.removeTag = removeTag;
  </script>
</body>
</html>
